{
    "contents" : "## modelSelection.R\n\n# model selection analysis on data collected on two plant species, Phalaris\n# arundinacea and Carex stricta.  The plants were grown in a growth chamber \n# under different soil nitrogen conditions (high, medium, low) and well as diff\n# temperature regimes (32/21 C & 25/18 C) and two photoperiods (14 h & 10h)\n# data was collected using a Li-6400 photosynthetsis machine to get data on\n# A/Ci and light response curves as well as leaf trait data like leaf N and SLA\n\n\n# The goal of the model selection is determine which of soil nitrogen, air\n# tempature, photoperiod or any combionation of the 3 most impact\n# photosynthetic processes. This will be used to potentially explain how each\n# species is influenced by their environmental changes (postivily or\n# negatively)\n\n# Main Question:  Will changes in soil N overcome issues with increased temp w/\n# climate change?\n\n#Hypothesis\n#H1: Changes in soil nitrogen have a greater impact on photosynthesis and leaf\n#traits than do temperature and photoperiod\n#H2: Changes in temperature have a greater impact on photosynthesis and \n#leaf traits than do soil nitrogen and photoperiod\n#H3: Changes in photoperiod have a greater impact on photosynthesis and leaf\n#traits than do soil nitrogen and temperature.\n#H4: Impacts on photosynthesis and leaf traits is species dependent with these \n#species.\n\n# I'd rephrase those more in line with my PLoS One paper. Eg \"We exmained three\n# potential drivers and all combinations of these three to determine the main\n# influence on photosynthetic rate.\n\n\nlibrary(nlme)\nlibrary(ade4)\nlibrary(AICcmodavg)\nlibrary(xtable)\n\n\nallData <- read.csv(\"GCdata.csv\")\n\n\n# calculate CN ratio plus species subsets\nallData$CN <- allData$Carbon / allData$Nitrogen\n# Setting up independent variables as factors\nallData$photoperiodf <- factor(allData$phoper,\n                               labels = c(\"10 h\", \"14 h\"))\nallData$tempf <- factor(allData$temp,\n                        labels=c(\"25/18 C\", \"32/21 C\"))\nallData$species <- factor(allData$spp,\n                          labels=c(\"C. stricta\", \"P. arundinacea\"))\nallDataClean<-allData # for making table of data plus PC axis\n\n# transformations for skewed data\nallData$SLA<-log10(allData$SLA)\nallData$vcmax<-log10(allData$vcmax)\nallData$jmax<-log10(allData$jmax)\nallData$Nitrogen<-log10(allData$Nitrogen)\nallData$CN<-log10(allData$CN)\n\n## DWS: you want natural log? I would think it is more common to use base 10.\n## Same effect on transformation but easier to make readable axes for all of\n## the decimal thinking brains.\n\n# getting only columns wanted for PCA by groups\ngcPCAlc <-allData[, c(7, 13, 20,18)] #light response parameters aamb, dr, netqe, jmax\ngcPCAaci <-allData[, c(8,10,21,23)] # co2 assimilation parameters amax, vcmax, ce, pnue\ngcPCAt <-allData[, c(9,19,22,24)] # trait parameters \n\n# DWS: \"Parameters\"? Or response variables? You are using the PCA scores on the\n# left-hand side of the models, correct?\n\n#names for the models once they are built\nmodnames <- c(\"treatment\",\"temperature\",\"photoperiod\",\"treatmentXtemperature\",\n              \"treatmentXphotoperiod\", \"photoperiodXtemperature\", \"species\",\n              \"speciesXtemperature\", \"speciesXtreatment\", \"speciesXphotoperiod\")\n\n# Might be safer to name models and then use names for labels. You have to keep\n# track of list indices manually your way. But it works.\n\n# PCA of light curve data\npca.gclc <- dudi.pca(gcPCAlc,scale=T,scannf=F)\nkip <- 100 * pca.gclc$eig/sum(pca.gclc$eig)\ncumsum(kip)\nscatter(pca.gclc)\ns.label(pca.gclc$co,boxes=F)\npca.gclc$eig #check # of axis with eig>1. Test these.\n\n# add PC to data\nallData$PCA1lc <- pca.gclc$li$Axis1\nallData$PCA2lc <- pca.gclc$li$Axis2\n\n\n# standard null hypothesis testing on axis 1 and 2\n\nlc1<-lme(PCA1lc ~ species+nTreatment+tempf+photoperiodf+species:nTreatment+\n           species:tempf+species:photoperiodf+nTreatment:tempf+\n           nTreatment:photoperiodf+tempf:photoperiodf, random =~1|plant_id,\n         data=allData)\n\nanova(lc1)\n\nlc2<-lme(PCA2lc ~ species+nTreatment+tempf+photoperiodf+species:nTreatment+\n           species:tempf+species:photoperiodf+nTreatment:tempf+\n           nTreatment:photoperiodf+tempf:photoperiodf, random =~1|plant_id,\n         data=allData)\n\nanova(lc2)\n\n#anova tables\nlc<-xtable(anova(lc1))\nprint(lc, type=\"html\", file=\"PCA1lc_anova.html\")\nlc2<-xtable(anova(lc2))\nprint(lc2, type=\"html\", file=\"PCA2lc_anova.html\")\n\n# candidate models for PCA1\n\n# DWS: No such thing as plant_id, changing to plant_id. But check that factor to\n# make sure it is correct.\n# 15 plants total?\n\ncand.modlc<-list()\ncand.modlc[[1]] <- lme(PCA1lc ~ trt, # what is trt?  vague name.\n                       random=~1|plant_id,method=\"ML\", data=allData)\ncand.modlc[[2]] <- lme(PCA1lc ~ tempf,\n                       random=~1|plant_id,method=\"ML\", data=allData)\ncand.modlc[[3]] <- lme(PCA1lc ~ photoperiodf,\n                       random=~1|plant_id,method=\"ML\", data=allData)\n# adding the +0 removes the intercept but allows me to look at the  interaction\ncand.modlc[[4]] <- lme(PCA1lc ~ trt:tempf+0,\n                       random=~1|plant_id,method=\"ML\", data=allData)\n# You do not want to test interaction only! And why remove intercept? Oh,\n# because your dummy coding is overspecified otherwise, got it. But don't do\n# this: you are not really testing for the importance of the interaction this\n# way. If you want to explicitly test interaction you need to compare mdoel\n# with main effects and interactionw to modelw ith just main effects. See\n# http://stats.stackexchange.com/questions/11009/including-the-interaction-but-not-the-main-effects-in-a-model\n# and also\n# http://stats.stackexchange.com/questions/27724/do-all-interactions-terms-need-their-individual-terms-in-regression-model\ncand.modlc[[5]] <- lme(PCA1lc ~ trt:photoperiodf+0,\n                       random=~1|plant_id,method=\"ML\", data=allData)\ncand.modlc[[6]] <- lme(PCA1lc ~ photoperiodf:tempf+0,\n                       random=~1|plant_id,method=\"ML\", data=allData)\ncand.modlc[[7]] <- lme(PCA1lc ~ species,\n                       random=~1|plant_id,method=\"ML\", data=allData)\ncand.modlc[[8]] <- lme(PCA1lc ~ species:tempf+0,\n                       random=~1|plant_id,method=\"ML\", data=allData)\ncand.modlc[[9]] <- lme(PCA1lc ~ species:trt+0,\n                       random=~1|plant_id,method=\"ML\", data=allData)\ncand.modlc[[10]] <- lme(PCA1lc ~ species:photoperiodf+0,\n                       random=~1|plant_id,method=\"ML\", data=allData)\n\n# models for PCA2\ncand.modlc2<-list()\ncand.modlc2[[1]] <- lme(PCA2lc ~ trt,\n                        random=~1|plant_id,method=\"ML\", data=allData)\ncand.modlc2[[2]] <- lme(PCA2lc ~ tempf,\n                        random=~1|plant_id,method=\"ML\", data=allData)\ncand.modlc2[[3]] <- lme(PCA2lc ~ photoperiodf,\n                        random=~1|plant_id,method=\"ML\", data=allData)\ncand.modlc2[[4]] <- lme(PCA2lc ~ trt:tempf+0,\n                        random=~1|plant_id,method=\"ML\", data=allData)\ncand.modlc2[[5]] <- lme(PCA2lc ~ trt:photoperiodf+0,\n                        random=~1|plant_id,method=\"ML\", data=allData)\ncand.modlc2[[6]] <- lme(PCA2lc ~ photoperiodf:tempf+0,\n                        random=~1|plant_id,method=\"ML\", data=allData)\ncand.modlc2[[7]] <- lme(PCA2lc ~ species,\n                        random=~1|plant_id,method=\"ML\", data=allData)\ncand.modlc2[[8]] <- lme(PCA2lc ~ species:tempf+0,\n                       random=~1|plant_id,method=\"ML\", data=allData)\ncand.modlc2[[9]] <- lme(PCA2lc ~ species:trt+0,\n                       random=~1|plant_id,method=\"ML\", data=allData)\ncand.modlc2[[10]] <- lme(PCA2lc ~ species:photoperiodf+0,\n                        random=~1|plant_id,method=\"ML\", data=allData)\n# aic table for PCA 1 and PCA2 of LC\n\n# pca 1 is driven by species and is therefore not included\naictab(cand.modlc, modnames)\nevidence(aictab(cand.modlc, modnames))\n\naictab(cand.modlc2, modnames)\nevidence(aictab(cand.modlc2, modnames))\n\nlcSPP<-xtable(aictab(cand.modlc, modnames))\nprint(lcSPP, type=\"html\", file=\"AICcLCSPP.html\")\nlc<-xtable(aictab(cand.modlc2, modnames))\nprint(lc, type=\"html\", file=\"AICcLC.html\")\n\n###########################################################################\n# PCA of acidata\npca.gca <- dudi.pca(gcPCAaci,scale=T,scannf=F)\nkip <- 100 * pca.gca$eig/sum(pca.gca$eig)\ncumsum(kip)\nscatter(pca.gca)\ns.label(pca.gca$co,boxes=F)\npca.gca$eig #check # of axis with eig>1. Test these.\n\n# add PC to data\nallData$PCA1a <- pca.gca$li$Axis1\n\n\n# null hypothesis\nac1<-lme(PCA1a ~ species+nTreatment+tempf+photoperiodf+species:nTreatment+\n           species:tempf+species:photoperiodf+nTreatment:tempf+\n           nTreatment:photoperiodf+tempf:photoperiodf, random =~1|plant_id,\n         data=allData)\n\nanova(ac1)\n\n#anova tables\nac<-xtable(anova(ac1))\nprint(ac, type=\"html\", file=\"PCA1aci_anova.html\")\n\n# candadate models for PCA1\ncand.moda<-list()\ncand.moda[[1]] <- lme(PCA1a ~ trt,\n                      random=~1|plant_id2,method=\"ML\", data=allData)\ncand.moda[[2]] <- lme(PCA1a ~ tempf,\n                      random=~1|plant_id2,method=\"ML\", data=allData)\ncand.moda[[3]] <- lme(PCA1a ~ photoperiodf,\n                      random=~1|plant_id2,method=\"ML\", data=allData)\ncand.moda[[4]] <- lme(PCA1a ~ trt*tempf,\n                      random=~1|plant_id2,method=\"ML\", data=allData)\ncand.moda[[5]] <- lme(PCA1a ~ trt*photoperiodf,\n                      random=~1|plant_id2,method=\"ML\", data=allData)\ncand.moda[[6]] <- lme(PCA1a ~ photoperiodf*tempf,\n                      random=~1|plant_id2,method=\"ML\", data=allData)\ncand.moda[[7]] <- lme(PCA1a ~ species,\n                      random=~1|plant_id2,method=\"ML\", data=allData)\ncand.moda[[8]] <- lme(PCA1a ~ species:tempf+0,\n                       random=~1|plant_id2,method=\"ML\", data=allData)\ncand.moda[[9]] <- lme(PCA1a ~ species:trt+0,\n                       random=~1|plant_id2,method=\"ML\", data=allData)\ncand.moda[[10]] <- lme(PCA1a ~ species:photoperiodf+0,\n                        random=~1|plant_id2,method=\"ML\", data=allData)\n\n# aic table for PCA 1 for aci\n\naictab(cand.moda, modnames)\nevidence(aictab(cand.moda, modnames))\n\n\n\naci<-xtable(aictab(cand.moda, modnames))\nprint(aci, type=\"html\", file=\"AICcACI.html\")\n###########################################################################\n# PCA of traits\npca.gct <- dudi.pca(gcPCAt,scale=T,scannf=F)\nkip <- 100 * pca.gct$eig/sum(pca.gct$eig)\ncumsum(kip)\nscatter(pca.gct)\ns.label(pca.gct$co,boxes=F)\npca.gct$eig #check # of axis with eig>1. Test these.\n\n# add PC to data\nallData$PCA1t <- pca.gct$li$Axis1\nallData$PCA2t <- pca.gct$li$Axis2\n\n\nt1<-lme(PCA1t ~ species+nTreatment+tempf+photoperiodf+species:nTreatment+\n           species:tempf+species:photoperiodf+nTreatment:tempf+\n           nTreatment:photoperiodf+tempf:photoperiodf, random =~1|plant_id,\n         data=allData)\n\nanova(t1)\n\nt2<-lme(PCA2t ~ species+nTreatment+tempf+photoperiodf+species:nTreatment+\n           species:tempf+species:photoperiodf+nTreatment:tempf+\n           nTreatment:photoperiodf+tempf:photoperiodf, random =~1|plant_id,\n         data=allData)\n\nanova(t2)\n\n#anova tables\nt<-xtable(anova(t1))\nprint(t, type=\"html\", file=\"PCA1t_anova.html\")\nt2<-xtable(anova(t2))\nprint(t2, type=\"html\", file=\"PCA2t_anova.html\")\n\n# candadate models for PCA1\ncand.modt<-list()\ncand.modt[[1]] <- lme(PCA1t ~ trt,\n                      random=~1|plant_id2,method=\"ML\", data=allData)\ncand.modt[[2]] <- lme(PCA1t ~ tempf,\n                      random=~1|plant_id2,method=\"ML\", data=allData)\ncand.modt[[3]] <- lme(PCA1t ~ photoperiodf,\n                      random=~1|plant_id2,method=\"ML\", data=allData)\ncand.modt[[4]] <- lme(PCA1t ~ trt*tempf,\n                      random=~1|plant_id2,method=\"ML\", data=allData)\ncand.modt[[5]] <- lme(PCA1t ~ trt*photoperiodf,\n                      random=~1|plant_id2,method=\"ML\", data=allData)\ncand.modt[[6]] <- lme(PCA1t ~ photoperiodf*tempf,\n                      random=~1|plant_id2,method=\"ML\", data=allData)\ncand.modt[[7]] <- lme(PCA1t ~ species,\n                      random=~1|plant_id2,method=\"ML\", data=allData)\ncand.modt[[8]] <- lme(PCA1t ~ species:tempf+0,\n                       random=~1|plant_id2,method=\"ML\", data=allData)\ncand.modt[[9]] <- lme(PCA1t ~ species:trt+0,\n                       random=~1|plant_id2,method=\"ML\", data=allData)\ncand.modt[[10]] <- lme(PCA1t ~ species:photoperiodf+0,\n                        random=~1|plant_id2,method=\"ML\", data=allData)\n# models for PCA2\ncand.modt2<-list()\ncand.modt2[[1]] <- lme(PCA2t ~ trt,\n                       random=~1|plant_id2,method=\"ML\", data=allData)\ncand.modt2[[2]] <- lme(PCA2t ~ tempf,\n                       random=~1|plant_id2,method=\"ML\", data=allData)\ncand.modt2[[3]] <- lme(PCA2t ~ photoperiodf,\n                       random=~1|plant_id2,method=\"ML\", data=allData)\ncand.modt2[[4]] <- lme(PCA2t ~ trt*tempf,\n                       random=~1|plant_id2,method=\"ML\", data=allData)\ncand.modt2[[5]] <- lme(PCA2t ~ trt*photoperiodf,\n                       random=~1|plant_id2,method=\"ML\", data=allData)\ncand.modt2[[6]] <- lme(PCA2t ~ photoperiodf*tempf,\n                       random=~1|plant_id2,method=\"ML\", data=allData)\ncand.modt2[[7]] <- lme(PCA2t ~ species,\n                       random=~1|plant_id2,method=\"ML\", data=allData)\ncand.modt2[[8]] <- lme(PCA2t ~ species+tempf+species:tempf,\n                       random=~1|plant_id2,method=\"ML\", data=allData)\ncand.modt2[[9]] <- lme(PCA2t ~ species:trt+0,\n                       random=~1|plant_id2,method=\"ML\", data=allData)\ncand.modt2[[10]] <- lme(PCA2t ~ species:photoperiodf+0,\n                        random=~1|plant_id2,method=\"ML\", data=allData)\n# aic table for PCA 1 and PCA2 of traits\n\n# pca 1 is driven y species and is therefore not included\naictab(cand.modt, modnames)\nevidence(aictab(cand.modt, modnames))\n\n\naictab(cand.modt2, modnames)\nevidence(aictab(cand.modt2, modnames))\n\ntraits<-xtable(aictab(cand.modt, modnames))\nprint(traits, type=\"html\", file=\"AICctraits1.html\")\ntraits2<-xtable(aictab(cand.modt2, modnames))\nprint(traits2, type=\"html\", file=\"AICctraits2.html\")\n\n#############################################################################\n##### Below is a playground of data exploration currently please ignore######\n#############################################################################\n# adding in PC\nallDataClean$PCA1lc <- pca.gclc$li$Axis1\nallDataClean$PCA2lc <- pca.gclc$li$Axis2\nallDataClean$PCA1a <- pca.gca$li$Axis1\nallDataClean$PCA1t <- pca.gct$li$Axis1\nallDataClean$PCA2t <- pca.gct$li$Axis2\n\n\nallM<-ddply(allDataClean, .(species, trt, tempf, photoperiodf), summarize,\n            aamb_sd=sd(aamb),\n            aamb=mean(aamb),\n            amax_sd=sd(amax),\n            amax=mean(amax),\n            C_sd=sd(Carbon),\n            C=mean(Carbon),\n            ce_sd=sd(ce),\n            ce=mean(ce),\n            CN_sd=sd(CN),\n            CN=mean(CN),\n            dr_sd=sd(dr),\n            dr=mean(dr),\n            jmax_sd=sd(jmax),\n            jmax=mean(jmax),\n            N_sd=sd(Nitrogen),\n            N=mean(Nitrogen),\n            netqe_sd=sd(netqe),\n            netqe=mean(netqe),\n            pnue_sd=sd(pnue),\n            pnue=mean(pnue),\n            SLA_sd=sd(SLA),\n            SLA=mean(SLA),\n            vcmax_sd=sd(vcmax),\n            vcmax=mean(vcmax))\n\nwrite.csv(allM, \"allM.csv\")\n\nPCAloadings<-allData[, c(3,4,25,26, 28:32)]\n\nall<-xtable(PCAloadings)\nprint(all, type=\"html\", file=\"allDataPCA.html\")\n\n# figures\n\ntextsize <- 18\nthemeopts <- theme( axis.title.y = element_text(size = textsize, \n                                                angle = 90,vjust=0.3) ,\n                    axis.title.x = element_text(size = textsize,\n                                                vjust=-0.3),\n                    panel.background = element_blank(), \n                    panel.border = element_rect(fill=NA), \n                    axis.text.x = element_text(size=16,color = \"black\"),\n                    axis.text.y = element_text(size=16, color = \"black\"),\n                    legend.title = element_text(size = 16),\n                    legend.text = element_text(size = 16), \n                    strip.text.x = element_text(size = textsize), \n                    strip.text.y = element_text(size = textsize), \n                    strip.background = element_blank(),\n                    legend.background=element_blank(),\n                    legend.key = element_rect(fill = \"white\"))\n\n\n# Light Curve\n\nnames(allData)[1] <- \"levels\"\nallData$levels <- as.factor(allData$levels)\nlevels(allData$levels) <- c(\"25 C 14 h\", \"25 C 10 h\", \"32 C 14 h\",\n                            \"32 C 10 h\")\n\nnames(allData)[1] <- \"plant_id\"\n\n# for figure making\no<-c(\"a\",\"b\",\"c\")\nt<-c(\"high\",\"med\",\"low\")\norder2<-data.frame(order=o,trt=t)\n\nallData<-merge(allData, order2, by=\"trt\")\n\n#  getting the slope and intercept from best fit model\n\n# for light curves used the intercept values from summary (null intercetpt +-\n# the intercept for each term)\n\nsummary(cand.modlc2[[6]])\n\nggplot(allData, aes(tempf, PCA2lc))+\n  geom_point(size=2)+\n  geom_abline(intercept=-0.4761538, slope=0.2849049, color=\"black\") +\n  geom_abline(intercept=0.637381, slope= -0.660915, color=\"red\")+\n  themeopts\n\n# intercept values and slope from model 4 currently using model 1\nsummary(cand.moda[[4]])\nggplot(allData, aes(order, PCA1a, shape=order, linetype=order))+\n  geom_abline(intercept=-0.8252878, slope=0.7086908, color=\"black\")+\n  scale_shape_discrete(name=\"N Treatment\", \n                       labels=c(\"High\",\"Medium\", \"Low\"))+\n  scale_x_discrete(name=\"N Treatment\", \n                       labels=c(\"High\",\"Medium\", \"Low\"))+\n  geom_point(size=2)+\n  themeopts\n\nggplot(allData, aes(species,PCA2t, shape=species, linetype=species))+\n  geom_abline(intercept=1.14327, slope=-2.27116, color=\"black\")+\n  geom_point(size=2)+\n  themeopts\n",
    "created" : 1445280796581.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "861154310",
    "id" : "A08D7C97",
    "lastKnownWriteTime" : 1425080811,
    "path" : "~/GitHub/growthChamber/growthChamber/scripts/modelSelection.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 5,
    "source_on_save" : false,
    "type" : "r_source"
}