{
    "contents" : "# Data exploration for data collected in Marshall County, IN in 2012 and 2013 by\n# Lizz Waring and Scott Holaday. \n\n# Data being used to answer the following questions\n# 1) How do Carex stricta (Cs) and Phalaris arundinacea(Pa) N-use strategies \n# differ seasonally? (2012)\n# 2) Do seasonal changes in leaf phys/morph traits relate to soil N?(2012/2013)\n# 3) model fits for influence on leafphys/morph traits? \n\n# factor anaylis for q2? library(psych)\n\n\n# packages needed\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(ggplot2)\nlibrary(nlme)\nlibrary(ade4)\nlibrary(AICcmodavg)\n\n# for making figures\nsource(\"theme-opts.R\")\n\n# data import use github folder \"data\" as working directory\n\nsoil12 <- read.csv(\"lachat2012.csv\")\nsoil13 <- read.csv(\"lachat2013.csv\")\n\nplants12 <- read.csv(\"data2012.csv\")\nplants13 <- read.csv(\"data2013.csv\")\n\n\n\n# filter 2013 site that were sampled in 2012                                   \n\n\nsoil12$year <- 2012\nsoil13$year <- 2013\n\nsub13 <- soil13 %>% filter(place==15|place==16)\nsub12 <- soil12 %>% group_by(site, rep, month, place,year) %>%\n        summarise(ammonia.g=mean(ammonia.g),\n                              ammonia.kg=mean(ammonia.kg),\n                              no3.no2.g=mean(no3.no2.g),\n                              no3.no2.kg=mean(no3.no2.kg))\n\n\n\n\nsoil <- bind_rows(sub13, sub12)\nsoil$yearf <- factor(soil$year,\n                        labels=c(\"2012\", \"2013\"))\nsoil$placef <- factor(soil$place,\n                         labels = 1:2)\n\n\n# keep in soil data from other sites besides 82a1 and 82a2\nallSoil <- bind_rows(sub12,soil13)\nallSoil$placef <- factor(allSoil$place,\n                        labels = 1:2)\nallSoil$yearf <- factor(allSoil$year,\n                       labels=c(\"2012\", \"2013\"))\n# comparasion between year\n\namm.aov <- lm(ammonia.kg~month+place+year+month:year, data=soil)\nsummary(amm.aov)\nanova(amm.aov)\n\nggplot(soil, aes(month, ammonia.kg, shape=placef, color=yearf)) +\n  geom_point() +\n  geom_smooth(method=\"lm\", se=F) +\n  scale_color_manual(name=\"Year\",\n                     values = c(\"black\", \"gray50\")) +\n  themeopts\n\nggsave(\"ammoniaYear.pdf\")\n\nnit.aov <- lm(no3.no2.kg~month+place+year+month:year, data=soil)\nsummary(nit.aov)\nanova(nit.aov)\n\nggplot(soil, aes(month, no3.no2.kg, shape=placef, color=yearf)) +\n  geom_point() +\n  geom_smooth(method=\"lm\", se=F) +\n  scale_color_manual(name=\"Year\",\n                     values = c(\"black\", \"gray50\")) +\n  themeopts\n\nggsave(\"NO2+3Year.pdf\")\n\n# grouping similar measurments from 2012 and 2013\n# get only Cs and Pa in plants 13\nplants13 <- plants13 %>% filter(spp==\"Cs\"|spp==\"Pa\")\n\np2013 <- plants13 %>% group_by(site, rep, month, place, spp) %>%\n  select(totC,C13,totN,SLA,LMA,ug.gfw_pr)\np2013$year <- \"2013\"\np2013$indi <- length(p2013$site)\n\np2012 <- plants12 %>% group_by(indi,site, rep, month, place, spp) %>%\n  select(totC,C13,totN,SLA,LMA,ug.gfw_pr)\np2012$year <- \"2012\"\n\nplants <- rbind(p2012, p2013)\n\n\nplants$placef <- factor(plants$place,\n                               labels = 1:22)\nplants$yearf <- factor(plants$year,\n                        labels=c(\"2012\", \"2013\"))\nplants$species <- factor(plants$spp,\n                          labels=c(\"C. stricta\", \"P. arundinacea\"))\n# subset of only sites sampled in 2012 and 2013\n\nplantSub <- p2013 %>% filter(place==15|place==16)\nplantSub <- rbind(p2012, plantSub)\nplantSub$placef <- factor(plantSub$place,\n                        labels = 1:2)\nplantSub$yearf <- factor(plantSub$year,\n                       labels=c(\"2012\", \"2013\"))\nplantSub$species <- factor(plantSub$spp,\n                         labels=c(\"C. stricta\", \"P. arundinacea\"))\nplantSub$LMA <- as.numeric(plantSub$LMA)\nplantSub$pro_area <- plantSub$ug.gfw_pr * plantSub$LMA\n\n\n\n\n#  comparasion between year\n\ntotN.aov <- lm(totN~spp+month+place+year+month:year, data=plantSub)\nsummary(totN.aov)\nanova(totN.aov)\n\nggplot(plantSub, aes(month, totN, shape=placef, color=yearf)) +\n  geom_point() +\n  geom_smooth(method=\"lm\", se=F) +\n  scale_color_manual(name=\"Year\",\n                     values = c(\"black\", \"gray50\")) +\n  facet_grid(species~.)+\n  themeopts\nggsave(\"TotalNYear.pdf\")\n\n\ntotC.aov <- lm(totC~spp+month+place+year+month:year, data=plantSub)\nsummary(totC.aov)\nanova(totC.aov)\n\nggplot(plantSub, aes(month, totC, shape=placef, color=yearf)) +\n  geom_point() +\n  geom_smooth(method=\"lm\", se=F) +\n  scale_color_manual(name=\"Year\",\n                     values = c(\"black\", \"gray50\")) +\n  facet_grid(species~.)+\n  themeopts\nggsave(\"TotalCYear.pdf\")\n\nc13.aov <- lm(C13~spp+month+place+year+month:year, data=plantSub)\nsummary(c13.aov)\nanova(c13.aov)\n\nggplot(plantSub, aes(month, C13, shape=placef, color=yearf)) +\n  geom_point() +\n  geom_smooth(method=\"lm\", se=F) +\n  scale_color_manual(name=\"Year\",\n                     values = c(\"black\", \"gray50\")) +\n  facet_grid(species~.)+\n  themeopts\nggsave(\"C13Year.pdf\")\n\nSLA.aov <- lm(SLA~spp+month+place+year+month:year, data=plantSub)\nsummary(SLA.aov)\nanova(SLA.aov)\n\nggplot(plantSub, aes(month, SLA, shape=placef, color=yearf)) +\n  geom_point() +\n  geom_smooth(method=\"lm\", se=F) +\n  scale_color_manual(name=\"Year\",\n                     values = c(\"black\", \"gray50\")) +\n  facet_grid(species~.)+\n  themeopts\n\nggsave(\"SLAYear.pdf\")\n\npr.aov <- lm(pre_area~spp+month+place+year+month:year, data=plantSub)\nsummary(pr.aov)\nanova(pr.aov)\n\nggplot(plantSub, aes(month, pro_area, shape=placef, color=yearf)) +\n  geom_point() +\n  geom_smooth(method=\"lm\", se=F) +\n  scale_color_manual(name=\"Year\",\n                     values = c(\"black\", \"gray50\")) +\n  labs(y=\"ug protein per cm^2\")+\n  facet_grid(species~.)+\n  themeopts\n\nggsave(\"proteinYear.pdf\")\n\n# to answer question 1 need data from 2012. Using mixed effects model to \n# analyize how physioloigcal traits differed seasonally and what this means\n# for both Cs and Pa.  Possibly doing a PCA to compress data like Waring and\n# Holaday growth chamber experiment\n\n# data used: ce, amba, vcmax, jmax, NR activity by weight(mgcl2.hr),\n# NR activity by chl (nr.hr.chl), protien(ug.gfw_pr), SLA, totN, totC, C13\n\n\n# constants from Niinemets et al 1998\n\nvcr = 20.5\njmc = 156\ncb = 2.15\n\n# convert totN from mass base to area base\nplants12$Na = plants12$LMA * plants12$totN\n\n# get vcmax, jmax, and chl on mass basis\n\nplants12$vcmaxM <- plants12$LMA * plants12$vcmax\nplants12$jmaxM <- plants12$LMA * plants12$jmax\nplants12$chlM <- plants12$LMA * plants12$chl\n\n# from niiements 1997 \"A model separating leaf structural and\n# physiological effects on carbon gain along light gradients for the \n# shade-tolerant species Acer saccharum\".  Also see \n# Oecologia (2007) 153:501â€“510 by Feng\n\nplants12$PC <- plants12$vcmaxM/(6.25*vcr*plants12$Na)\nplants12$PB <- plants12$jmaxM/(8.06*jmc*plants12$Na)\nplants12$PL <- plants12$chlM/(plants12$totN*cb)\n\n\n\n# will figure out a quicker way to do this\nplants12$placef <- factor(plants12$place,\n                          labels = 1:2)\nplants12$species <- factor(plants12$spp,\n                           labels=c(\"C. stricta\", \"P. arundinacea\"))\n\npc.lme <- lme(PC ~ spp+month+place+spp:place+spp:month, \n                         random=~1|indi, data=plants12, na.action=na.omit)\nanova(pc.lme)\n\nggplot(data=plants12, aes(month, PC, color=species, shape=species)) +\n  geom_point(size=3)+\n  scale_color_manual(name=\"species\",\n                     values = c(\"black\", \"gray50\"))+\n  themeopts\nggsave(\"PC.pdf\")\n\npb.lme <- lme(PB ~ spp+month+place+spp:place+spp:month, \n              random=~1|indi, data=plants12, na.action=na.omit)\nanova(pb.lme)\n\nggplot(data=plants12, aes(month, PB, color=species, shape=species)) +\n  geom_point(size=3)+\n  scale_color_manual(name=\"species\",\n                     values = c(\"black\", \"gray50\"))+\n  themeopts\nggsave(\"PB.pdf\")\n\npl.lme <- lme(PL ~ spp+month+place+spp:place+spp:month, \n              random=~1|indi, data=plants12, na.action=na.omit)\nanova(pl.lme)\n\nggplot(data=plants12, aes(month, PL, color=species, shape=species)) +\n  geom_point(size=3)+\n  scale_color_manual(name=\"species\",\n                     values = c(\"black\", \"gray50\"))+\n  themeopts\n\nggsave(\"PL.pdf\")\n\n# reshape proprotion data for figure making.\n\nallP <- plants12 %>% gather(\"Npartition\", \"percentN\", 32:34, na.rm=T) %>%\n  select(indi, place, month, species, Npartition, percentN)\n\nallPM <- ddply(allP, .(month, species, variable), summarize,\n               proportion = mean(value),\n               proportionSD = sd(value))\n\nggplot(data=allPM, aes(month, proportion, color=variable, shape=variable)) +\n  geom_pointrange(aes(ymin=proportion-proportionSD,\n                      ymax=proportion+proportionSD))+\n  scale_color_manual(name=\"N placement\",\n                     values = c(\"black\", \"gray50\", \"blue\"))+\n  facet_grid(.~species)+\n  themeopts\n\nggsave(\"PALL.pdf\")\n\npca <- plants12 %>% select(ce,amba,vcmax,jmax,mgcl2.hr,nr.hr.chl,chl,\n                           ug.gfw_pr, \n                           SLA,totN,totC,C13, PC,PB,PL)\npca <- na.omit(pca)\n\npca <- cor(pca)\n\n\nPCA12 <- dudi.pca(pca,scale=T,scannf=F, nf=3)\nsums <- 100 * PCA12$eig/sum(PCA12$eig)\ncumsum(sums)\nscatter(PCA12)\ns.label(PCA12$co,boxes=F)\nPCA12$eig #check # of axis with eig>1. Test these.\n\nloadings <- PCA12$co\n\nwrite.csv(loadings, \"loadings.csv\")\n\nplants12$PCA1 <- PCA12$li$Axis1\nplants12$PCA2 <- PCA12$li$Axis2\nplants12$PCA3 <- PCA12$li$Axis3\n\n# stats for questions one\nphoto12.aov <- lme(PCA1 ~ spp+month+place+spp:place+spp:month, \n                     random=~1|indi, data=plants12)\nanova(photo12.aov)\n\ntraits12.aov <- lme(PCA2 ~ spp+month+place+spp:place+spp:month, \n                   random=~1|indi, data=plants12)\nanova(traits12.aov)\n\nbiochem12.aov <- lme(PCA3 ~ spp+month+place+spp:place+spp:month, \n                   random=~1|indi, data=plants12)\nanova(biochem12.aov)\n# to answer question 2, Do seasonal changes in leaf phys/morph traits relate \n# to soil N? Need data from both 2012 and 2013.  Since there was no statistical\n# differences between leaf N or C13 or protein in 2012 and 2013 can include \n# both.  Need data on leaf N, C13, leaf C, CN, SLA, and leaf protien as well\n# as well soil N\n\n# current plan is a mixed effects model.  Nested by individual.  Time is\n# continous. \n\n\n\nall <- merge(allSoil, p2013, by=c(\"place\",\"month\",\"rep\", \"year\",\"site\"))\nall$soilN <- all$ammonia.kg + all$no3.no2.kg\nall$ratio <- all$ammonia.kg/all$no3.no2.kg\nall$cn <- all$totC/all$totN\n\nall$speciesN <- as.numeric(factor(all$spp,labels=c(1:2)))\n\n\nall$place <- as.numeric(all$place)\nall$month <- as.numeric(all$month)\nall$speciesN <- as.numeric(all$speciesN)\nall$year <- as.numeric(all$year)\n\npcaA <- all %>% select(place, month, speciesN, soilN)\npcaA <- na.omit(pcaA)\n\npcaA <- cor(pcaA)\n\n\nPCA13 <- dudi.pca(pcaA,scale=T,scannf=F, nf=3)\nsums <- 100 * PCA13$eig/sum(PCA13$eig)\ncumsum(sums)\nscatter(PCA13)\ns.label(PCA13$co,boxes=F)\nPCA13$eig #check # of axis with eig>1. Test these.\n\nloadings13 <- PCA13$co\n\n# Ranking the soil N in by 50 g of N\nall$soilFactor <- as.factor(ceiling(all$soilN/50))\n\nn.lme <- lme(totN ~ soilN + month + spp + soilN:month +\n               soilN:spp, random =~soilN|place,\n    data=all, na.action=na.omit)\n\nanova(n.lme)\n\nggplot(all, aes(soilN, totN, shape=spp, color=spp)) +\n  geom_point()+\n  facet_grid(month~.)+ \n  scale_color_manual(name=\"N species\",\n                     values = c(\"black\", \"gray50\"))+\n  geom_smooth(method=\"lm\", se=F)+themeopts\n\n# with soil rankings\nggplot(all, aes(month, totN, shape=soilFactor, fill=soilFactor)) +\n  geom_point()+\n  facet_grid(spp~.)+ \n  scale_shape_manual(name=\"Total soil N (g/kg)\",\n                     values=c(21,21,22,22,23,23,24,24,25,25))+\n  scale_fill_manual(name=\"Total soil N (g/kg)\",\n                    values = c(\"black\", NA, \"black\", NA, \"black\",NA,\"black\",NA,\"black\",NA)) +\n  themeopts\n\nggsave(\"totN12_13.pdf\")\n\nsla.lme <- lme(SLA ~ soilN + month + spp + soilN:month + soilN:spp + place, random =~1|place,\n             data=all, na.action=na.omit)\n\nanova(sla.lme)\n\nggplot(all, aes(soilN, SLA, shape=spp, color=spp)) +\n  geom_point()+\n  facet_grid(month~.)+\n  scale_color_manual(name=\"N species\",\n                     values = c(\"black\", \"gray50\"))+\n  geom_smooth(method=\"lm\", se=F)+themeopts\n\nggsave(\"sla12_13.pdf\")\n\nc13.lme <- lme(C13 ~ soilN + month + spp + soilN:month + soilN:spp + place, random =~1|place,\n               data=all, na.action=na.omit)\n\nanova(c13.lme)\n\nggplot(all, aes(soilN, C13, shape=spp, color=spp)) +\n  geom_point()+\n  facet_grid(month~.)+\n  scale_color_manual(name=\"N species\",\n                     values = c(\"black\", \"gray50\"))+\n  geom_smooth(method=\"lm\", se=F)+themeopts\n\nggsave(\"c1312_13.pdf\")\n\ncn.lme <- lme(cn ~ soilN + month + spp + soilN:month + soilN:spp, random =~1|place,\n               data=all, na.action=na.omit)\n\nanova(cn.lme)\n\nggplot(all, aes(soilN, cn, shape=spp, color=spp)) +\n  geom_point()+\n  facet_grid(month~.)+\n  scale_color_manual(name=\"N species\",\n                     values = c(\"black\", \"gray50\"))+\n  geom_smooth(method=\"lm\", se=F)+themeopts\n\nggsave(\"CN12_13.pdf\")\n\npr.lme <- lme(ug.gfw_pr ~ soilN + month + spp + soilN:month + soilN:spp + place, random =~1|place,\n               data=all, na.action=na.omit)\n\nanova(pr.lme)\n\nggplot(all, aes(soilN, ug.gfw_pr, shape=spp, color=spp)) +\n  geom_point()+\n  facet_grid(month~.)+\n  scale_color_manual(name=\"N species\",\n                     values = c(\"black\", \"gray50\"))+\n  geom_smooth(method=\"lm\", se=F)+themeopts\n\nggsave(\"pr12_13.pdf\")\n\n\n# possibly use model selection for quesiton 2\n\nmodnames <- c(\"soilN\", \"month\", \"species\", \"soilN X month\", \"soilN X species\",\n              \"place\")\n\n# start with leaf N\ncand.leafN<-list()\ncand.leafN[[1]] <- lme(totN ~ soilN,\n                        random=~1|place,method=\"ML\", data=all, \n                       na.action=na.omit)\ncand.leafN[[2]] <- lme(totN ~ month,\n                        random=~1|place,method=\"ML\", data=all,\n                       na.action=na.omit)\ncand.leafN[[3]] <- lme(totN ~ spp,\n                        random=~1|place,method=\"ML\", data=all,\n                       na.action=na.omit)\ncand.leafN[[4]] <- lme(totN ~ soilN*month,\n                        random=~1|place,method=\"ML\", data=all,\n                        na.action=na.omit)\ncand.leafN[[5]] <- lme(totN ~ soilN*spp,\n                        random=~1|place,method=\"ML\", data=all,\n                       na.action=na.omit)\ncand.leafN[[6]] <- lme(totN ~ place,\n                        random=~1|place,method=\"ML\", data=all,\n                       na.action=na.omit)\n\nlibrary(AICcmodavg)\n\naictab(cand.leafN, modnames)\nevidence(aictab(cand.leafN, modnames))\n\n# SLA\n\ncand.SLA<-list()\ncand.SLA[[1]] <- lme(SLA ~ soilN,\n                       random=~1|place,method=\"ML\", data=all, \n                       na.action=na.omit)\ncand.SLA[[2]] <- lme(SLA ~ month,\n                       random=~1|place,method=\"ML\", data=all,\n                       na.action=na.omit)\ncand.SLA[[3]] <- lme(SLA ~ spp,\n                       random=~1|place,method=\"ML\", data=all,\n                       na.action=na.omit)\ncand.SLA[[4]] <- lme(SLA ~ soilN*month,\n                       random=~1|place,method=\"ML\", data=all,\n                       na.action=na.omit)\ncand.SLA[[5]] <- lme(SLA ~ soilN*spp,\n                       random=~1|place,method=\"ML\", data=all,\n                       na.action=na.omit)\ncand.SLA[[6]] <- lme(SLA ~ place,\n                       random=~1|place,method=\"ML\", data=all,\n                       na.action=na.omit)\naictab(cand.SLA, modnames)\nevidence(aictab(cand.SLA, modnames))\n\n# cn\ncand.cn<-list()\ncand.cn[[1]] <- lme(cn ~ soilN,\n                     random=~1|place,method=\"ML\", data=all, \n                     na.action=na.omit)\ncand.cn[[2]] <- lme(cn ~ month,\n                     random=~1|place,method=\"ML\", data=all,\n                     na.action=na.omit)\ncand.cn[[3]] <- lme(cn ~ spp,\n                     random=~1|place,method=\"ML\", data=all,\n                     na.action=na.omit)\ncand.cn[[4]] <- lme(cn ~ soilN*month,\n                     random=~1|place,method=\"ML\", data=all,\n                     na.action=na.omit)\ncand.cn[[5]] <- lme(cn ~ soilN*spp,\n                     random=~1|place,method=\"ML\", data=all,\n                     na.action=na.omit)\ncand.cn[[6]] <- lme(cn ~ place,\n                     random=~1|place,method=\"ML\", data=all,\n                     na.action=na.omit)\naictab(cand.cn, modnames)\nevidence(aictab(cand.cn, modnames))\n\ncand.pr<-list()\ncand.pr[[1]] <- lme(ug.gfw_pr ~ soilN,\n                    random=~1|place,method=\"ML\", data=all, \n                    na.action=na.omit)\ncand.pr[[2]] <- lme(ug.gfw_pr ~ month,\n                    random=~1|place,method=\"ML\", data=all,\n                    na.action=na.omit)\ncand.pr[[3]] <- lme(ug.gfw_pr ~ spp,\n                    random=~1|place,method=\"ML\", data=all,\n                    na.action=na.omit)\ncand.pr[[4]] <- lme(ug.gfw_pr ~ soilN*month,\n                    random=~1|place,method=\"ML\", data=all,\n                    na.action=na.omit)\ncand.pr[[5]] <- lme(ug.gfw_pr ~ soilN*spp,\n                    random=~1|place,method=\"ML\", data=all,\n                    na.action=na.omit)\ncand.pr[[6]] <- lme(ug.gfw_pr ~ place,\n                    random=~1|place,method=\"ML\", data=all,\n                    na.action=na.omit)\naictab(cand.pr, modnames)\nevidence(aictab(cand.pr, modnames))\n\n\n\n",
    "created" : 1439917717420.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2462153696",
    "id" : "6E00BFEF",
    "lastKnownWriteTime" : 1447354278,
    "path" : "~/GitHub/Indiana201213/scripts/dataExplorer.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "type" : "r_source"
}