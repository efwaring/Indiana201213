{
    "contents" : "# Data exploration for data collected in Marshall County, IN in 2012 and 2013 by\n# Lizz Waring and Scott Holaday. \n\n# Data being used to answer the following questions\n# 1) How do Carex stricta (Cs) and Phalaris arundinacea(Pa) N-use strategies \n# differ seasonally? (2012)\n# 2) Do seasonal changes in leaf phys/morph traits relate to soil N?(2012/2013)\n# 3) model fits for influence on leafphys/morph traits? \n\n# factor anaylis for q2? library(psych)\n\n\n# packages needed\nlibrary(plyr)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(ggplot2)\nlibrary(nlme)\nlibrary(AICcmodavg)\n\n\n# for making figures\nsource(\"theme-opts.R\")\n\n# data import use github folder \"data\" as working directory\n\nsoil12 <- read.csv(\"lachat2012.csv\")\nsoil13 <- read.csv(\"lachat2013.csv\")\nsoilPRS <- read.csv(\"PRS_Soil.csv\")\n\nplants12 <- read.csv(\"data2012.csv\")\nplants13 <- read.csv(\"data2013.csv\")\n\n\n\n# filter 2013 site that were sampled in 2012                                   \n\n\nsoil12$year <- 2012\nsoil13$year <- 2013\n\nsub13 <- soil13 %>% filter(place==15|place==16)\nsub12 <- soil12 %>% group_by(site, rep, month, place,year) %>%\n        summarise(ammonia.kg=mean(ammonia.kg),\n                              no3.no2.kg=mean(no3.no2.kg))\n\n\n\n\nsoil <- bind_rows(sub13, sub12)\nsoil$yearf <- factor(soil$year,\n                        labels=c(\"2012\", \"2013\"))\nsoil$placef <- factor(soil$place,\n                         labels = 1:2)\nallsoilD <- ddply(soil, .(place, year, month), summarize,\n                  ammonia.kg_sd = sd(ammonia.kg),\n                  ammonia.kg=mean(ammonia.kg),\n                  no3.no2.kg_sd = sd(no3.no2.kg),\n                  no3.no2.kg=mean(no3.no2.kg))\nwrite.csv(allsoilD, \"allsoil.csv\")\n\n\n# keep in soil data from other sites besides 82a1 and 82a2\nallSoil <- bind_rows(sub12,soil13)\nallSoil$placef <- factor(allSoil$place,\n                        labels = 1:2)\nallSoil$yearf <- factor(allSoil$year,\n                       labels=c(\"2012\", \"2013\"))\n\n# comparasion between year\n\namm.aov <- lm(ammonia.kg~month+place+year+month:year, data=soil)\nsummary(amm.aov)\nanova(amm.aov)\n\n\n\nnit.aov <- lm(no3.no2.kg~month+place+year+month:year, data=soil)\nsummary(nit.aov)\nanova(nit.aov)\n\n# PRS probes\n\nprs.aov <- lm(Total.N~date+site+year+date:year, data=soilPRS)\nsummary(prs.aov)\nanova(prs.aov)\n\nprsAVG <- ddply(soilPRS, .(site, year, date), summarize,\n                Total.N.sd = sd(Total.N),\n                Total.N = mean(Total.N),\n                NO3_sd =sd (NO3),\n                NO3=mean(NO3),\n                NH4_sd=sd(NH4),\n                NH4=mean(NH4))\n\nwrite.csv(prsAVG, \"prsAVG.csv\")\n\n\n# grouping similar measurments from 2012 and 2013\n# get only Cs and Pa in plants 13\nplants13 <- plants13 %>% filter(spp==\"Cs\"|spp==\"Pa\")\n\np2013 <- plants13 %>% group_by(site, rep, month, place, spp) %>%\n  select(totC,C13,totN,SLA,LMA,ug.gfw_pr)\np2013$year <- \"2013\"\np2013$indi <- length(p2013$site)\n\np2012 <- plants12 %>% group_by(indi,site, rep, month, place, spp) %>%\n  select(totC,C13,totN,SLA,LMA,ug.gfw_pr)\np2012$year <- \"2012\"\n\nplants <- rbind(p2012, p2013)\nplants$indi <- NULL\n\n\nplants$placef <- factor(plants$place,\n                               labels = 1:22)\nplants$yearf <- factor(plants$year,\n                        labels=c(\"2012\", \"2013\"))\nplants$species <- factor(plants$spp,\n                          labels=c(\"C. stricta\", \"P. arundinacea\"))\n# subset of only sites sampled in 2012 and 2013\n\nplantSub <- p2013 %>% filter(place==15|place==16)\nplantSub <- rbind(p2012, plantSub)\nplantSub$placef <- factor(plantSub$place,\n                        labels = 1:2)\nplantSub$yearf <- factor(plantSub$year,\n                       labels=c(\"2012\", \"2013\"))\nplantSub$species <- factor(plantSub$spp,\n                         labels=c(\"C. stricta\", \"P. arundinacea\"))\nplantSub$LMA <- as.numeric(plantSub$LMA)\nplantSub$pro_area <- plantSub$ug.gfw_pr * plantSub$LMA\nplantSub$indi <- NULL\n\n\nplantSub2 <- na.omit(plantSub)\n\nplantSub_dd <- ddply(plantSub2, .(month, spp, site, rep, yearf), summarize,\n                     totC=mean(totC),\n                     C13=mean(C13),\n                     totN=mean(totN),\n                     pro_area=mean(pro_area),\n                     SLA=mean(SLA))\nwrite.csv(plantSub_dd, \"AVgplantsbetweenyears.csv\")\n#  comparasion between year\n\ntotN.aov <- lm(totN~spp+month+place+year+month:year, data=plantSub)\nsummary(totN.aov)\nanova(totN.aov)\n\ntotC.aov <- lm(totC~spp+month+place+year+month:year, data=plantSub)\nsummary(totC.aov)\nanova(totC.aov)\n\nc13.aov <- lm(C13~spp+month+place+year+month:year, data=plantSub)\nsummary(c13.aov)\nanova(c13.aov)\n\n\nSLA.aov <- lm(SLA~spp+month+place+year+month:year, data=plantSub)\nsummary(SLA.aov)\nanova(SLA.aov)\n\npr.aov <- lm(pre_area~spp+month+place+year+month:year, data=plantSub)\nsummary(pr.aov)\nanova(pr.aov)\n\n\n# to answer question 1 need data from 2012. Using mixed effects model to \n# analyize how physioloigcal traits differed seasonally and what this means\n# for both Cs and Pa.  Possibly doing a PCA to compress data like Waring and\n# Holaday growth chamber experiment\n\n# data used: ce, amba, vcmax, jmax, NR activity by weight(mgcl2.hr),\n# NR activity by chl (nr.hr.chl), protien(ug.gfw_pr), SLA, totN, totC, C13\n\n\n# constants from Niinemets et al 1998\n\nvcr = 20.5\njmc = 156\ncb = 2.15\n\n# convert totN from mass base to area base\nplants12$Na = plants12$LMA * plants12$totN\n\n# get vcmax, jmax, and chl on mass basis\n\nplants12$vcmaxM <- plants12$LMA * plants12$vcmax\nplants12$jmaxM <- plants12$LMA * plants12$jmax\nplants12$chlM <- plants12$LMA * plants12$chl\n\n# from niiements 1997 \"A model separating leaf structural and\n# physiological effects on carbon gain along light gradients for the \n# shade-tolerant species Acer saccharum\".  Also see \n# Oecologia (2007) 153:501â€“510 by Feng\n\nplants12$PC <- plants12$vcmaxM/(6.25*vcr*plants12$Na)\nplants12$PB <- plants12$jmaxM/(8.06*jmc*plants12$Na)\nplants12$PL <- plants12$chlM/(plants12$totN*cb)\n\n\n\n# will figure out a quicker way to do this\nplants12$placef <- factor(plants12$place,\n                          labels = 1:2)\nplants12$species <- factor(plants12$spp,\n                           labels=c(\"C. stricta\", \"P. arundinacea\"))\n\npc.lme <- lme(PC ~ spp+month+place+spp:place+spp:month, \n                         random=~1|indi, data=plants12, na.action=na.omit)\nanova(pc.lme)\n\nggplot(data=plants12, aes(month, PC, color=species, shape=species)) +\n  geom_point(size=3)+\n  scale_color_manual(name=\"species\",\n                     values = c(\"black\", \"gray50\"))+\n  themeopts\nggsave(\"PC.pdf\")\n\npb.lme <- lme(PB ~ spp+month+place+spp:place+spp:month, \n              random=~1|indi, data=plants12, na.action=na.omit)\nanova(pb.lme)\n\nggplot(data=plants12, aes(month, PB, color=species, shape=species)) +\n  geom_point(size=3)+\n  scale_color_manual(name=\"species\",\n                     values = c(\"black\", \"gray50\"))+\n  themeopts\nggsave(\"PB.pdf\")\n\npl.lme <- lme(PL ~ spp+month+place+spp:place+spp:month, \n              random=~1|indi, data=plants12, na.action=na.omit)\nanova(pl.lme)\n\nggplot(data=plants12, aes(month, PL, color=species, shape=species)) +\n  geom_point(size=3)+\n  scale_color_manual(name=\"species\",\n                     values = c(\"black\", \"gray50\"))+\n  themeopts\n\nggsave(\"PL.pdf\")\n\n# reshape proprotion data for figure making.\n\nallP <- plants12 %>% gather(\"Npartition\", \"percentN\", 32:34, na.rm=T) %>%\n  select(indi, place, month, species, Npartition, percentN)\n\nallPM <- ddply(allP, .(month, species, Npartition,place), summarize,\n               proportion = mean(percentN),\n               proportionSD = sd(percentN))\n\nallPM$site <- factor(allPM$place, labels=c(\"Site 1\",\"Site2\"))\n\nggplot(data=allPM, aes(month, proportion, color=Npartition, shape=Npartition)) +\n  geom_pointrange(aes(ymin=proportion-proportionSD,\n                      ymax=proportion+proportionSD))+\n  scale_color_manual(name=\"Allocation\",\n                     values = c(\"black\", \"gray50\", \"blue\"),\n                     labels=c(\"Carboxylation\", \"Bioenergics\",\"Light Harvest\"))+\n  scale_shape_manual(name=\"Allocation\", values=c(1,2,5),\n                     labels=c(\"Carboxylation\", \"Bioenergics\",\"Light Harvest\"))+\n  facet_grid(species~site)+\n  labs(y=\"Proportion N\")+\n  themeopts\n\nggsave(\"PALL_sites.pdf\")\n\npca <- plants12 %>% select(ce,amba,vcmax,jmax,mgcl2.hr,nr.hr.chl,chl,\n\n# to answer question 2, Do seasonal changes in leaf phys/morph traits relate \n# to soil N? Need data from both 2012 and 2013.  Since there was no statistical\n# differences between leaf N or C13 or protein in 2012 and 2013 can include \n# both.  Need data on leaf N, C13, leaf C, CN, SLA, and leaf protien as well\n# as well soil N\n\n# current plan is a mixed effects model.  Nested by individual.  Time is\n# continous. \n\n\n# reshape so only columns needed are there\n\nsoil13_1 <- soil13 %>% select(place, month, year, ammonia.kg, no3.no2.kg)\np2013_1 <- p2013 %>% select(place, month, year, spp, LMA, SLA, totN, totC,\n                            C13, ug.gfw_pr) \np2013_1$site <- NULL\np2013_1$rep <-NULL\np2013_1 <-subset(p2013_1, month!=\"12\")\n\n\nall <- merge(soil13_1, p2013_1, all=T, by=c(\"place\",\"month\", \"year\"))\nall$soilN <- all$ammonia.kg + all$no3.no2.kg\nall$ratio <- all$ammonia.kg/all$no3.no2.kg\nall$cn <- all$totC/all$totN\nall$LMA <- as.numeric(all$LMA)\nall$pro_area <- all$ug.gfw_pr * all$LMA\n\nall$place <- as.numeric(all$place)\nall$month <- as.numeric(all$month)\nall$speciesN <- as.numeric(all$speciesN)\nall$year <- as.numeric(all$year)\n\n\n\n# remove MW 4 (place 12).\n#This site ended up being in outlier to do problems with  soilN\n\nall <- subset(all, place!=\"12\")\n\n#analysis\nn.lme <- lme(totN ~ soilN + month + spp + soilN:month +\n               soilN:spp, random =~1|place,\n    data=all, na.action=na.omit)\n\nanova(n.lme)\n\nggplot(all, aes(soilN, totN, shape=spp, color=spp)) +\n  geom_point(size=3)+\n  facet_grid(month~.)+ \n  stat_smooth(method = \"lm\", formula = y ~ x + I(x^2), size = 1, se=F)+\n  scale_color_manual(name=\"species\",\n                     values = c(\"black\", \"gray50\"),\n                     labels= c(\"Carex stricta\",\"Phalaris arudinacea\"))+\n  scale_shape_manual(name=\"species\",values=c(1,2), \n                     labels= c(\"Carex stricta\",\"Phalaris arudinacea\"))+\n  labs(x=(\"Total soil N (ppm)\"), y=(\"Total leaf N (%)\"))+\n  themeopts\n\nggsave(\"totN13.pdf\")\n\nsla.lme <- lme(SLA ~ soilN + month + spp + soilN:month + soilN:spp,\n               random =~1|place,\n             data=all, na.action=na.omit)\n\nanova(sla.lme)\n\nggplot(all, aes(soilN, SLA, shape=spp, color=spp)) +\n  geom_point(size=3)+\n  facet_grid(month~.)+ \n  stat_smooth(method = \"lm\", formula = y ~ x + I(x^2), size = 1, se=F)+\n  scale_color_manual(name=\"species\",\n                     values = c(\"black\", \"gray50\"),\n                     labels= c(\"Carex stricta\",\"Phalaris arudinacea\"))+\n  scale_shape_manual(name=\"species\",values=c(1,2), \n                     labels= c(\"Carex stricta\",\"Phalaris arudinacea\"))+\n  labs(x=(\"Total soil N (ppm)\"), y=(\"SLA\"))+\n  themeopts\n\nggsave(\"sla13.pdf\")\n\nc13.lme <- lme(C13 ~ soilN + month + spp + soilN:month + soilN:spp,\n               random =~1|place,\n               data=all, na.action=na.omit)\n\nanova(c13.lme)\n\nggplot(all, aes(soilN, C13, shape=spp, color=spp)) +\n  geom_point(size=3)+\n  facet_grid(month~.)+ \n  stat_smooth(method = \"lm\", formula = y ~ x + I(x^2), size = 1, se=F)+\n  scale_color_manual(name=\"species\",\n                     values = c(\"black\", \"gray50\"),\n                     labels= c(\"Carex stricta\",\"Phalaris arudinacea\"))+\n  scale_shape_manual(name=\"species\",values=c(1,2), \n                     labels= c(\"Carex stricta\",\"Phalaris arudinacea\"))+\n  labs(x=(\"Total soil N (ppm)\"), y=(\"Total leaf N (%)\"))+\n  themeopts\n\nggsave(\"c13_13.pdf\")\n\n\n\npr.lme <- lme(pro_area ~ soilN + month + spp + soilN:month + soilN:spp + place, random =~1|place,\n               data=all, na.action=na.omit)\n\nanova(pr.lme)\n\nggplot(all, aes(soilN, log(pro_area), shape=spp, color=spp)) +\n  geom_point(size=3)+\n  facet_grid(month~.)+ \n  stat_smooth(method = \"lm\", formula = y ~ x + I(x^2), size = 1, se=F)+\n  scale_color_manual(name=\"species\",\n                     values = c(\"black\", \"gray50\"),\n                     labels= c(\"Carex stricta\",\"Phalaris arudinacea\"))+\n  scale_shape_manual(name=\"species\",values=c(1,2), \n                     labels= c(\"Carex stricta\",\"Phalaris arudinacea\"))+\n  labs(x=(\"Total soil N (ppm)\"), y=(\"log of Total Soluble Protein (ug/cm^2)\"))+\n  themeopts\n\nggsave(\"protein13.pdf\")\n\n\n# possibly use model selection for quesiton 2\n\nmodnames <- c(\"soilN\", \"month\", \"species\", \"soilN X month\", \"soilN X species\",\n              \"place\")\n\n# start with leaf N\ncand.leafN<-list()\ncand.leafN[[1]] <- lme(totN ~ soilN,\n                        random=~1|place,method=\"ML\", data=all, \n                       na.action=na.omit)\ncand.leafN[[2]] <- lme(totN ~ month,\n                        random=~1|place,method=\"ML\", data=all,\n                       na.action=na.omit)\ncand.leafN[[3]] <- lme(totN ~ spp,\n                        random=~1|place,method=\"ML\", data=all,\n                       na.action=na.omit)\ncand.leafN[[4]] <- lme(totN ~ soilN*month,\n                        random=~1|place,method=\"ML\", data=all,\n                        na.action=na.omit)\ncand.leafN[[5]] <- lme(totN ~ soilN*spp,\n                        random=~1|place,method=\"ML\", data=all,\n                       na.action=na.omit)\ncand.leafN[[6]] <- lme(totN ~ place,\n                        random=~1|place,method=\"ML\", data=all,\n                       na.action=na.omit)\n\nlibrary(AICcmodavg)\n\naictab(cand.leafN, modnames)\nevidence(aictab(cand.leafN, modnames))\n\n# SLA\n\ncand.SLA<-list()\ncand.SLA[[1]] <- lme(SLA ~ soilN,\n                       random=~1|place,method=\"ML\", data=all, \n                       na.action=na.omit)\ncand.SLA[[2]] <- lme(SLA ~ month,\n                       random=~1|place,method=\"ML\", data=all,\n                       na.action=na.omit)\ncand.SLA[[3]] <- lme(SLA ~ spp,\n                       random=~1|place,method=\"ML\", data=all,\n                       na.action=na.omit)\ncand.SLA[[4]] <- lme(SLA ~ soilN*month,\n                       random=~1|place,method=\"ML\", data=all,\n                       na.action=na.omit)\ncand.SLA[[5]] <- lme(SLA ~ soilN*spp,\n                       random=~1|place,method=\"ML\", data=all,\n                       na.action=na.omit)\ncand.SLA[[6]] <- lme(SLA ~ place,\n                       random=~1|place,method=\"ML\", data=all,\n                       na.action=na.omit)\naictab(cand.SLA, modnames)\nevidence(aictab(cand.SLA, modnames))\n\n# cn\ncand.cn<-list()\ncand.cn[[1]] <- lme(cn ~ soilN,\n                     random=~1|place,method=\"ML\", data=all, \n                     na.action=na.omit)\ncand.cn[[2]] <- lme(cn ~ month,\n                     random=~1|place,method=\"ML\", data=all,\n                     na.action=na.omit)\ncand.cn[[3]] <- lme(cn ~ spp,\n                     random=~1|place,method=\"ML\", data=all,\n                     na.action=na.omit)\ncand.cn[[4]] <- lme(cn ~ soilN*month,\n                     random=~1|place,method=\"ML\", data=all,\n                     na.action=na.omit)\ncand.cn[[5]] <- lme(cn ~ soilN*spp,\n                     random=~1|place,method=\"ML\", data=all,\n                     na.action=na.omit)\ncand.cn[[6]] <- lme(cn ~ place,\n                     random=~1|place,method=\"ML\", data=all,\n                     na.action=na.omit)\naictab(cand.cn, modnames)\nevidence(aictab(cand.cn, modnames))\n\ncand.pr<-list()\ncand.pr[[1]] <- lme(ug.gfw_pr ~ soilN,\n                    random=~1|place,method=\"ML\", data=all, \n                    na.action=na.omit)\ncand.pr[[2]] <- lme(ug.gfw_pr ~ month,\n                    random=~1|place,method=\"ML\", data=all,\n                    na.action=na.omit)\ncand.pr[[3]] <- lme(ug.gfw_pr ~ spp,\n                    random=~1|place,method=\"ML\", data=all,\n                    na.action=na.omit)\ncand.pr[[4]] <- lme(ug.gfw_pr ~ soilN*month,\n                    random=~1|place,method=\"ML\", data=all,\n                    na.action=na.omit)\ncand.pr[[5]] <- lme(ug.gfw_pr ~ soilN*spp,\n                    random=~1|place,method=\"ML\", data=all,\n                    na.action=na.omit)\ncand.pr[[6]] <- lme(ug.gfw_pr ~ place,\n                    random=~1|place,method=\"ML\", data=all,\n                    na.action=na.omit)\naictab(cand.pr, modnames)\nevidence(aictab(cand.pr, modnames))\n\n\n\n",
    "created" : 1448041704345.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1308564819",
    "id" : "F9977FF8",
    "lastKnownWriteTime" : 1452876919,
    "path" : "~/GitHub/Indiana201213/scripts/dataExplorer.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "type" : "r_source"
}