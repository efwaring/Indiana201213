{
    "contents" : "#!/usr/env Rscript\n\n# R code for figures and stats fo Carex manuscript (Guvvala, Schwilk, Holaday)\n# Dylan Schwilk 2014\n\n\nlibrary(ggplot2)\nlibrary(plyr)\nlibrary(scales)\nlibrary(nlme)\n\n\n# Multiple plot function\n#\n# ggplot objects can be passed in ..., or to plotlist (as a list of ggplot objects)\n# - cols:   Number of columns in layout\n# - layout: A matrix specifying the layout. If present, 'cols' is ignored.\n#\n# If the layout is something like matrix(c(1,2,3,3), nrow=2, byrow=TRUE),\n# then plot 1 will go in the upper left, 2 will go in the upper right, and\n# 3 will go all the way across the bottom.\n#\nmultiplot <- function(..., plotlist=NULL, file, cols=1, layout=NULL) {\n  require(grid)\n\n  # Make a list from the ... arguments and plotlist\n  plots <- c(list(...), plotlist)\n\n  numPlots = length(plots)\n\n  # If layout is NULL, then use 'cols' to determine layout\n  if (is.null(layout)) {\n    # Make the panel\n    # ncol: Number of columns of plots\n    # nrow: Number of rows needed, calculated from # of cols\n    layout <- matrix(seq(1, cols * ceiling(numPlots/cols)),\n                    ncol = cols, nrow = ceiling(numPlots/cols))\n  }\n\n if (numPlots==1) {\n    print(plots[[1]])\n\n  } else {\n    # Set up the page\n    grid.newpage()\n    pushViewport(viewport(layout = grid.layout(nrow(layout), ncol(layout))))\n\n    # Make each plot, in the correct location\n    for (i in 1:numPlots) {\n      # Get the i,j matrix positions of the regions that contain this subplot\n      matchidx <- as.data.frame(which(layout == i, arr.ind = TRUE))\n\n      print(plots[[i]], vp = viewport(layout.pos.row = matchidx$row,\n                                      layout.pos.col = matchidx$col))\n    }\n  }\n}\n\n# standard error\n# Just because Scott watned it.  I think we are only reporting SDs\nse <- function(x) sqrt(var(x,na.rm=TRUE)/length(na.omit(x)))\n\n## graphics parameters\n bestfit <- geom_smooth(method=\"lm\",se = F, size=1.7)\n textsize <- 22\n stextsize <- 20\n themeopts <- theme(panel.border = element_rect(colour = 'gray15', size=1.5),\n                   panel.background = NULL ,# theme_rect(fill=\"gray95\"),\n                   panel.grid.minor = element_blank(),\n                   panel.grid.major = element_blank(),                    \n                   strip.background = element_rect(colour = 'gray15', size=1.5, fill=\"gray95\"),\n                   axis.title.y = element_text(size = textsize, angle = 90),\n                   axis.title.x = element_text(size = textsize),\n                   strip.text.x = element_text(size = textsize),\n                   strip.text.y = element_text(size = textsize),\n                   axis.text.x  = element_text(size = stextsize, colour=\"gray15\"),\n                   axis.text.y  = element_text(size = stextsize, colour=\"gray15\"),\n                   legend.position=\"none\"\n                   )\n\n\n###############################################################################\n## Tables and Figures for revision 2014-04-15 with combined experiments\n###############################################################################\n\n# Table 1:\ntab1dat <- read.csv(\"Table 1-AandR.csv\")\ntable1 <- ddply(tab1dat, .(Species, factor(Ntreat)), summarize,\n                A.mean = mean(A, na.rm=TRUE), A.sd = sd(A, na.rm=TRUE),\n                A.se = se(A),\n                R.mean = mean(R, na.rm=TRUE), R.sd = sd(R, na.rm=TRUE),\n                R.se  = se(R))\n                \ntable1\n\n\n\nexp=read.csv(file=\"guvvala_experiments.csv\")\n#exp$treatf <- factor(exp$Ntreat, ordered=TRUE)\nexp = subset(exp, experiment !=1)\nexp$treat.log <- log10(exp$treat)\n\nexp$logLeafN.area <- log10(exp$leafN.area)\nexp$logLeafN.mass <- log10(exp$leafN.mass)\nexp$experiment <- factor(exp$experiment)\ngdata <- exp\n\n#############################################################\n### FIG 1:\n#############################################################\n## As gridded plot\n\ntbreaks = trans_breaks(\"log10\", function(x) 10^x)\ntlabels = trans_format(\"log10\", math_format(10^.x))\n\n## Fig. 1A\nfig1a <- ggplot(gdata, aes(treat, A, linetype=species, shape=species, color= species)) +\n   geom_point(size=3) +\n   scale_x_log10(\"Supplied Nitrogen (mM)\", breaks=tbreaks, labels=tlabels) +\n   labs(y=expression(paste(italic(A),\" (\", mu * mol %.% m^{-2} %.% s^{-1}, \")\")))  +\n   theme_bw() +\n   scale_linetype_manual(values = c(1,2)) +\n   scale_shape_manual(values=c(16,17)) +\n   scale_color_manual(values = c( \"grey50\", \"black\")) +\n   bestfit +\n   annotate(\"text\", label = \"A\", x = 0.25, y = 20.8, size = 12) +\n   themeopts \n  # annotation_logticks(sides=\"b\", scaled=FALSE,\n  #                       short = unit(1.2,\"mm\"), mid = unit(3,\"mm\"), long = unit(4,\"mm\"))\n\n\n\n# mixed effects model\n# modFig1A <- lme(A ~ species*treat, random = ~ 1 | experiment, data=gdata)\nmodFig1A <- lme(A ~ species*treat, random = ~ 1 | experiment, data=gdata)\nsummary(modFig1A)\nanova(modFig1A)\n\n## modFig1A <- lm(A ~ species*treat, data=gdata)\n## summary(modFig1A)\n## anova(modFig1A)\n\n\n## Fig. 1B\n## Y axis = Leaf Soluble Protein (mg cm-2)\n## X axis = Concentration of Supplied Nitrogen (log)\nfig1b <- ggplot(gdata, aes(treat, sol.protein, linetype=species, shape=species, color= species)) +\n   geom_point(size=3) +\n   scale_x_log10(\"Supplied Nitrogen (mM)\", breaks=tbreaks, labels=tlabels) +\n   labs(y=expression(paste(\"Leaf Soluble Protein (\", mg %.% cm^{-2}, \")\")))  +\n   theme_bw() +\n   scale_linetype_manual(values = c(1,2)) +\n   scale_shape_manual(values=c(16,17)) +\n   scale_color_manual(values = c( \"grey50\", \"black\")) +\n   bestfit +\n   themeopts +\n   annotate(\"text\", label = \"B\", x = 0.25, y = 0.3218, size = 12) \n\n\n# mixed effects model\n# modFig1A <- lme(A ~ species*treat, random = ~ 1 | experiment, data=gdata)\nmodFig1B <- lme(sol.protein ~ species*treat, random = ~ 1 | experiment, data=gdata, na.action= na.exclude)\nsummary(modFig1B)\nanova(modFig1B)\n\nmodFig1A <- lm(sol.protein ~ species*treat, data=gdata)\nsummary(modFig1A)\nanova(modFig1A)\n\npdf(\"Guvvala-et-al_Fig1-grid.pdf\", height = 15, width = 8, useDingbats = F)\nmultiplot(fig1a, fig1b, cols=1)\ndev.off()\n\n##############################################################################3\n## FIG 2\n##############################################################################3\n\n## FIG 2A\nfig2a <- ggplot(gdata, aes(treat, leafN.area, linetype=species, shape=species, color= species)) +\n   geom_point(size=3) +\n   scale_x_log10(\"\",  breaks=tbreaks, labels=tlabels) + #Supplied Nitrogen (mM)\") +\n   labs(y=expression(paste(\"Leaf Nitrogen (\",mg %.% cm^{-2}, \")\")))  +\n   theme_bw() +\n   scale_linetype_manual(values = c(1,2)) +\n   scale_shape_manual(values=c(16,17)) +\n   scale_color_manual(values = c( \"grey50\", \"black\")) +\n   annotate(\"text\", label = \"A\", x = 0.25, y = 0.312, size = 12) +\n   themeopts +\n   bestfit\n\n\n## Fig. 2B\n## Y axis = Leaf Nitrogen (mg g-1)\n## X axis = Concentration of Supplied Nitrogen (log)\nfig2b <- ggplot(gdata, aes(treat, leafN.mass, linetype=species, shape=species, color= species)) +\n   geom_point(size=3) +\n   scale_x_log10(\"\",  breaks=tbreaks, labels=tlabels) + #Supplied Nitrogen (mM)\") +\n   labs(y=expression(paste(\"Leaf Nitrogen (\",mg %.% g^{-1}, \")\")))  +\n   theme_bw() +\n   themeopts +\n   scale_linetype_manual(values = c(1,2)) +\n   scale_shape_manual(values=c(16,17)) +\n   scale_color_manual(values = c( \"grey50\", \"black\")) +\n     annotate(\"text\", label = \"B\", x = 0.25, y = 29.46, size = 12) +\n   bestfit\n\n## Fig. 2C\n## Y axis = Leaf Carbon:Nitrogen\n## X axis = Concentration of Supplied Nitrogen (log)\nfig2c <- ggplot(gdata, aes(treat, C.N, linetype=species, shape=species, color= species)) +\n   geom_point(size=3) +\n   scale_x_log10(\"Supplied Nitrogen (mM)\",  breaks=tbreaks, labels=tlabels) +\n   labs(y=\"Leaf Carbon:Nitrogen\")  +\n   theme_bw() +\n   themeopts +\n   scale_linetype_manual(values = c(1,2)) +\n   scale_shape_manual(values=c(16,17)) +\n   scale_color_manual(values = c( \"grey50\", \"black\")) +\n   bestfit +\n   annotate(\"text\", label = \"C\", x = 0.25, y = 30.45, size = 12) \n\n\npdf(\"Guvvala-et-al_Fig2-grid.pdf\", height = 20, width = 8, useDingbats = F)\nmultiplot(fig2a, fig2b, fig2c, cols=1)\ndev.off()\n\n\n################################################################################\n### FIG 3\n###############################################################################\n#### Grided version\nfmt3 <- function(){\n    function(x) format(x,nsmall = 3,scientific = FALSE)\n}\n\n# Fig 3A PNUE \nfig3a <- ggplot(gdata, aes(treat, PNUE, linetype=species, color=species, shape = species)) + geom_point(size=3) +\n   scale_x_log10(\"\", ,  breaks=tbreaks, labels=tlabels) +\n   scale_y_continuous(\"PNUE\", labels = fmt3()) +\n   theme_bw() +\n   themeopts +\n   scale_linetype_manual(values = c(1,2)) +\n   scale_shape_manual(values=c(16,17)) +\n   scale_color_manual(values = c( \"grey50\", \"black\")) +\n   bestfit +\n     annotate(\"text\", label = \"A\", x = 0.25, y = 0.01528, size = 12) \n\n# 3B PrNUE ANCOVA\nfig3b <- ggplot(gdata, aes(treat, PrNUE, linetype=species, color=species, shape=species) ) +\n   geom_point(size=3) +\n   scale_x_log10(\"Supplied Nitrogen (mM)\", breaks=tbreaks, labels=tlabels) +\n   scale_y_continuous(\"PrNUE\", labels = fmt3()) +\n   theme_bw() +\n   themeopts +\n   scale_linetype_manual(values = c(1,2)) +\n   scale_shape_manual(values=c(16,17)) +\n   scale_color_manual(values = c( \"grey50\", \"black\")) +\n   bestfit +\n   annotate(\"text\", label = \"B\", x = 0.25, y = 2.92, size = 12) \n\n\n\npdf(\"Guvvala-et-al_Fig3-grid.pdf\", height = 15, width = 8, useDingbats = FALSE)\nmultiplot(fig3a, fig3b, cols=1)\ndev.off()\n\n\n\n################################################################################\n## Fig. 4\n################################################################################\nexp2 <- read.csv(\"experiment2.csv\")\n\nfmt <- function(){\n    f <- function(x) as.character(round(x,0))\n    f\n}\n\nfig4 <- ggplot(exp2, aes(day, A, linetype=Species, shape=Species, color= Species)) +\n   geom_point(size=3) +\n   scale_x_continuous(\"Days at 15 mM Nitrogen\", labels = fmt()) +\n   scale_y_continuous(\n     expression(paste(italic(A), \" (\", mu * mol %.% m^{-2} %.% s^{-1}, \")\" )) )  +\n   theme_bw() +\n   scale_linetype_manual(values = c(1,2)) +\n   scale_shape_manual(values=c(16,17)) +\n   scale_color_manual(values = c( \"grey50\", \"black\")) +\n   themeopts + \n   bestfit\n\nfig4\nggsave(\"Guvvala-et-al_Fig4.eps\", height = 9, width = 8)\n\n\n################################################################################\n## FIG 5\n####################################3333\n\n## Fig. 5A\n## Y axis = Individual Leaf Area (cm2)\n## X axis = Concentration of Supplied Nitrogen (log)\nfig5a <- ggplot(gdata, aes(treat, LA, linetype=species, shape=species, color= species)) +\n   geom_point(size=3) +\n   scale_x_log10(\"\", breaks=tbreaks, labels=tlabels) +\n   labs(y=expression(paste(\"Individual Leaf Area (\", cm^{2}, \")\")))  +\n   theme_bw() +\n   scale_linetype_manual(values = c(1,2)) +\n   scale_shape_manual(values=c(16,17)) +\n   scale_color_manual(values = c( \"grey50\", \"black\")) +\n   bestfit +\n  themeopts +\n  annotate(\"text\", label = \"A\", x = 0.25, y = 35, size = 12) \n\n# do combined stats\n# mixed effects model\nmodFig5A <- lme(LA ~ species*treat, random = ~ 1 | experiment, data=gdata, na.action= na.exclude)\nsummary(modFig5A)\nanova(modFig5A)\n\n\n\n\n## Fig. 5B\n## Y axis = SLA (cm2 g-1)\n## X axis = Concentration of Supplied Nitrogen (log)\nfig5b <- ggplot(gdata, aes(treat, SLA, linetype=species, shape=species, color= species)) +\n   geom_point(size=3) +\n   scale_x_log10(\"Supplied Nitrogen (mM)\", breaks=tbreaks, labels=tlabels) +\n   labs(y=expression(paste(\"SLA (\",cm^{2} %.% g^{-1}, \")\")))  +\n   theme_bw() +\n   scale_linetype_manual(values = c(1,2)) +\n   scale_shape_manual(values=c(16,17)) +\n   scale_color_manual(values = c( \"grey50\", \"black\")) +\n   bestfit +\n   themeopts +\n   annotate(\"text\", label = \"B\", x = 0.25, y = 215, size = 12) \n\n# do combined stats\nmodFig5B <- lme(SLA ~ species*treat, random = ~ 1 | experiment, data=gdata, na.action= na.exclude)\nsummary(modFig5B)\nanova(modFig5B)\n\n\npdf(\"Guvvala-et-al_Fig5-grid.pdf\", height = 15, width = 8, useDingbats = FALSE)\nmultiplot(fig5a, fig5b, cols=1)\ndev.off()\n\n",
    "created" : 1453139996896.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3311206579",
    "id" : "91CD01C1",
    "lastKnownWriteTime" : 1410291290,
    "path" : "C:/Users/Lizz/Dropbox/Nitrate and Protein project/ms-code.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "type" : "r_source"
}